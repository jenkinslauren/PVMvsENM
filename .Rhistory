plot(bgTestSp, pch = 16, cex = 0.5, col = "red",
main = substitute(paste(italic('Fraxinus pennsylvanica '), 'background sites')))
map("state", add = TRUE)
rm(list = ls())
library(dplyr)
library(ggplot2)
library(tidyr)
library(raster)
library(rgdal)
library(enmSdm)
library(terra)
library(maxnet)
library(sf)
rm(list = ls())
library(dplyr)
library(ggplot2)
library(tidyr)
library(raster)
library(rgdal)
library(enmSdm)
library(terra)
library(maxnet)
library(sf)
library(maps)
library(rnaturalearth)
library(rnaturalearthdata)
library(rnaturalearthhires)
ll <- c('longitude', 'latitude')
sp <- 'Fraxinus pennsylvanica'
species <- 'fraxinus_pennsylvanica'
speciesAb <- 'FraxPenn'
speciesAb_ <- 'Frax_Penn'
load(paste0('./04 - Modeling Workspace - Clipping ', sp))
load(paste0('./03 - Modeling Workspace - ', speciesAb_, ' Cleaning'))
rangeMap <- littleRange_FraxPenn
# use the buffer/calibration region for extracting background sites
calibRegionSpAlb <- as(range_buffer_final, 'Spatial')
calibRegionSpAlb <- sp::spTransform(calibRegionSpAlb, getCRS('albersNA', TRUE))
calibRegionSpWgs <- sp::spTransform(calibRegionSpAlb, getCRS('wgs84', TRUE))
# get 10,000 random background sites from calibration region
bgTestSpAlb <- spsample(calibRegionSpAlb, n=10000, type='random')
bgTestSp <- sp::spTransform(bgTestSpAlb, getCRS('wgs84', TRUE))
bgTest <- as.data.frame(coordinates(bgTestSp))
names(bgTest) <- ll
# sanity check: plot the background sites
plot(bgTestSp, pch = 16, cex = 0.5, col = "red",
main = substitute(paste(italic('Fraxinus pennsylvanica '), 'background sites')))
map("state", add = TRUE)
map("world", add = TRUE)
# sanity check: plot the background sites
plot(bgTestSp, pch = 16, cex = 0.5, col = "red",
main = substitute(paste(italic('Fraxinus pennsylvanica '), 'background sites')))
plot(calibRegionSpWgs, add = TRUE, border = 'blue')
# sanity check: plot the background sites
plot(bgTestSp, pch = 16, cex = 0.5, col = "red",
main = substitute(paste(italic('Fraxinus pennsylvanica '), 'background sites')))
map("state", add = TRUE)
# use the buffer/calibration region for extracting background sites
calibRegionSpAlb <- as(range_buffer_final, 'Spatial')
calibRegionSpAlb <- sp::spTransform(calibRegionSpAlb, getCRS('albersNA', TRUE))
calibRegionSpWgs <- sp::spTransform(calibRegionSpAlb, getCRS('wgs84', TRUE))
# get 10,000 random background sites from calibration region
bgTestSpAlb <- spsample(calibRegionSpAlb, n=10000, type='random')
bgTestSp <- sp::spTransform(bgTestSpAlb, getCRS('wgs84', TRUE))
bgTest <- as.data.frame(coordinates(bgTestSp))
names(bgTest) <- ll
# sanity check: plot the background sites
plot(bgTestSp, pch = 16, cex = 0.5, col = "red",
main = substitute(paste(italic('Fraxinus pennsylvanica '), 'background sites')))
map("state", add = TRUE)
map("world", add = TRUE)
# use the buffer/calibration region for extracting background sites
calibRegionSpAlb <- as(range_buffer_final, 'Spatial')
calibRegionSpAlb <- sp::spTransform(calibRegionSpAlb, getCRS('albersNA', TRUE))
calibRegionSpWgs <- sp::spTransform(calibRegionSpAlb, getCRS('wgs84', TRUE))
# get 10,000 random background sites from calibration region
bgTestSpAlb <- spsample(calibRegionSpAlb, n=10000, type='random')
bgTestSp <- sp::spTransform(bgTestSpAlb, getCRS('wgs84', TRUE))
bgTest <- as.data.frame(coordinates(bgTestSp))
names(bgTest) <- ll
# sanity check: plot the background sites
plot(bgTestSp, pch = 16, cex = 0.5, col = "red",
main = substitute(paste(italic('Fraxinus pennsylvanica '), 'background sites')))
plot(calibRegionSpWgs, add = TRUE, border = 'blue')
map("state", add = TRUE)
map("world", add = TRUE)
# use the buffer/calibration region for extracting background sites
calibRegionSpAlb <- as(range_buffer_final, 'Spatial')
calibRegionSpAlb <- sp::spTransform(calibRegionSpAlb, getCRS('albersNA', TRUE))
calibRegionSpWgs <- sp::spTransform(calibRegionSpAlb, getCRS('wgs84', TRUE))
# get 10,000 random background sites from calibration region
bgTestSpAlb <- spsample(calibRegionSpAlb, n=10000, type='random')
bgTestSp <- sp::spTransform(bgTestSpAlb, getCRS('wgs84', TRUE))
bgTest <- as.data.frame(coordinates(bgTestSp))
names(bgTest) <- ll
# sanity check: plot the background sites
plot(bgTestSp, pch = 16, cex = 0.5, col = "red",
main = substitute(paste(italic('Fraxinus pennsylvanica '), 'background sites')))
plot(calibRegionSpWgs, add = TRUE, border = 'blue')
map("state", add = TRUE)
map("world", add = TRUE)
# extract environment at sites
climate <- envData
randomBgEnv <- raster::extract(climate, bgTest)
randomBgEnv <- as.data.frame(randomBgEnv)
# remove any sites with NA for at least one variable
isNa <- is.na(rowSums(randomBgEnv))
if (any(isNa)) {
randomBgSites <- bgTest[-which(isNa), ]
randomBgEnv <- randomBgEnv[-which(isNa), ]
}
# combine with coordinates and rename coordinate fields
randomBg <- cbind(randomBgSites, randomBgEnv)
names(randomBg)[1:2] <- ll
# define presences in background
presBg <- rep(c(1, 0), c(nrow(records), nrow(randomBgSites)))
occsEnv <- raster::extract(envData,
cbind(records$longitude,
records$latitude))
dir.create('./Background Sites', recursive=TRUE, showWarnings=FALSE)
save(randomBg,
file = paste0('./Background Sites/Random Background Sites across Study Region - ',
speciesAb, '.Rdata'),
compress=TRUE)
occsEnv <- raster::extract(envData,
cbind(records$longitude,
records$latitude))
occsEnvDf <- as.data.frame(occsEnv)
records <- cbind(records, occsEnvDf)
env <- rbind(occsEnv, randomBgEnv)
env <- cbind(presBg, env)
env <- as.data.frame(env)
# create output directory for model object and rasters
dir.create(paste0('./Models/', speciesAb_, '_Maxent'),
recursive=TRUE, showWarnings=FALSE)
# model species
envModel <- enmSdm::trainMaxNet(data = env, resp = "presBg")
# envModel <- maxnet(p = presBg, data = trainData)
modelFileName <- paste0('./Models/', speciesAb_, '_Maxent/Model.Rdata')
save(envModel, file = modelFileName, compress=TRUE)
predictors <- c('pca1', 'pca2', 'pca3')
# prediction
envMap <- predict(
climate[[predictors]],
envModel,
filename=paste0('./Models/', speciesAb_, '_Maxent/maxentPredictionBeyer0KYBP'),
clamp = F,
format='GTiff',
overwrite = TRUE,
type='cloglog')
envMapSp <- rasterToPolygons(envMap)
# envMapSf <- st_as_sf(envMapSp,
#                      coords = c(x = 'longitude', y = 'latitude'),
#                       crs = getCRS("wgs84", TRUE))
# rangeMapSf <- st_transform(st_as_sf(x = range), getCRS('wgs84', TRUE))
# recordsSf <- speciesSf <- st_as_sf(x = records,
#                       coords = c(x = 'longitude',
#                                  y = 'latitude'),
#                       crs = getCRS('wgs84', TRUE))
#
# world <- ne_countries(scale = "medium", returnclass = "sf")
# states <- st_as_sf(ne_states(country = 'united states of america'))
# canada <- st_as_sf(ne_states(country = 'canada'))
# sf object doesn't really work
# ggplot(data = world) +
#   theme_bw() +
#   geom_sf(fill = "white") +
#   geom_sf(data = states, fill = NA) +
#   geom_sf(data = canada, fill = NA) +
#   geom_sf(data = envMapSf) +
#   geom_sf(data = rangeMapSf,
#           color = 'darkgreen',
#           fill = 'green',
#           alpha = 0.4,
#           inherit.aes = FALSE) +
#   geom_sf(data = recordsSf,
#           color = 'red',
#           pch = 16,
#           cex = 0.4) +
#   coord_sf(xlim = c(min(records$longitude), max(records$longitude)),
#            ylim = c(min(records$latitude), max(records$latitude)), expand = TRUE) +
#   xlab("Longitude") +
#   ylab("Latitude") +
#   theme(panel.grid.major = element_line(color = gray(0.5), linetype = "dashed",
#                                         size = 0.5), panel.background = element_rect(fill = "lavender"))
plot(rangeMap, border = 'blue', main = substitute(paste('Maxent output, ',
italic('Fraxinus americana '),
'occurrences')))
plot(envMap, add = TRUE)
plot(rangeMap, border = 'blue', add = TRUE)
map("state", add = TRUE)
map("world", add = TRUE)
points(records$longitude, records$latitude, pch = 16, cex = 0.6, col = 'red')
save.image(paste0('./05 - Modeling Workspace - ', speciesAb_, ' Model Output'))
# load(paste0('./05 - Modeling Workspace - ', speciesAb_, ' Model Output'))
rm(list = ls())
library(megaSDM)
library(sf)
ll <- c('longitude', 'latitude')
speciesList <- c('Fraxinus americana', 'Fraxinus caroliniana', 'Fraxinus cuspidata'
,'Fraxinus greggii', 'Fraxinus nigra', 'Fraxinus pennsylvanica',
'Fraxinus profunda', 'Fraxinus quadrangulata')
input_TA <- list.files('./data_and_analyses/env_data/Beyer/tifs',
pattern = '.tif', full.names = TRUE)
input_TA <- input_TA[!grepl('.*pca_output.*\\.tif', input_TA)]
# where training & study rasters will be printed out to
envoutput <- "megaSDM_TestRun"
# define extent of training & study region
TSEnv <- TrainStudyEnv(input_TA = input_TA,
output = envoutput,
clipTrain = c(-178.2166, 83.7759, -55.90223, 83.6236),
clipStudy = c(-178.2166, 83.7759, -55.90223, 83.6236))
library(raster)
library(rgdal)
# define extent of training & study region
TSEnv <- TrainStudyEnv(input_TA = input_TA,
output = envoutput,
clipTrain = c(-178.2166, 83.7759, -55.90223, 83.6236),
clipStudy = c(-178.2166, 83.7759, -55.90223, 83.6236))
library(dplyr)
library(ggplot2)
library(tidyr)
# define extent of training & study region
TSEnv <- TrainStudyEnv(input_TA = input_TA,
output = envoutput,
clipTrain = c(-178.2166, 83.7759, -55.90223, 83.6236),
clipStudy = c(-178.2166, 83.7759, -55.90223, 83.6236))
setwd('/Volumes/LJ MacBook Backup/MOBOT/PVMvsENM')
input_TA <- input_TA[!grepl('.*pca_output.*\\.tif', input_TA)]
input_TA <- list.files('./data_and_analyses/env_data/Beyer/tifs',
pattern = '.tif', full.names = TRUE)
input_TA <- input_TA[!grepl('.*pca_output.*\\.tif', input_TA)]
# where training & study rasters will be printed out to
envoutput <- "megaSDM_TestRun"
# define extent of training & study region
TSEnv <- TrainStudyEnv(input_TA = input_TA,
output = envoutput,
clipTrain = c(-178.2166, 83.7759, -55.90223, 83.6236),
clipStudy = c(-178.2166, 83.7759, -55.90223, 83.6236))
# PredictEnv clips, resamples, and reprojects the past environmental layers to
## match the study region rasters created with TrainStudyEnv.
folders <- list()
for (i in (1:19)[-c(2,3)]) {
folders <- append(folders,
file.path('data_and_analyses','env_data','Beyer','tifs', paste0('BIO', i)))
}
folders <- append(folders,
file.path('data_and_analyses','env_data','Beyer','tifs', 'cloudiness'))
folders <- append(folders,
file.path('data_and_analyses','env_data','Beyer','tifs', 'relative_humidity'))
climYears <- seq(1000, 21000, by=1000)
envList <- list()
envYears <- function(yr) {
return(unlist(sapply(folders, function(folder) {
paste0('./', list.files(folder, pattern = paste0("_", yr, "ybp.tif"), full.names=TRUE))
})))
}
envList <- append(envList, lapply(climYears, envYears))
names <- list()
for (n in length(names(TSEnv$study))){
for(i in (1:21)[-c(2,3)]) {
for (yr in c(0,climYears)) {
if (i == 20) {
names <- append(names, paste0("cloudiness", "_", yr, "ybp"))
} else if (i == 21) {
names <- append(names, paste0("relative_humidity", "_", yr, "ybp"))
} else {
names <- append(names, paste0("BIO", i, "_", yr, "ybp"))
}
names(TSEnv$study) <- c(names)
prediction <- PredictEnv(studylayers = TSEnv$study,
futurelayers = envList,
time_periods = c(0, climYears),
output = envoutput,
scenario_name = "Beyer")
class(TSEnv$training)
length(occlist)
occlist <- list.files('./megaSDM_TestRun', pattern = '.csv', full.names = T)
occ_output <- "./megaSDM_TestRun/occurrences"
length(occlist)
#Reads the occurrence file
SpeciesOcc <- utils::read.csv(occlist[1])
View(SpeciesOcc)
SpeciesSplit <- unlist(strsplit(occlist[1], "/", fixed = TRUE))
SpeciesName <- substr(SpeciesSplit[length(SpeciesSplit)], 1,
nchar(SpeciesSplit[length(SpeciesSplit)]) - 4)
SpecCol <- grep(paste0("^", SpeciesName, "$|", "^", gsub("_", " ", SpeciesName), "$"),
SpeciesOcc[1,])
if (length(SpecCol) == 1) {
names(SpeciesOcc)[SpecCol] <- "Species"
} else {
SpeciesOcc$Species <- rep(SpeciesName, nrow(SpeciesOcc))
}
toCSV <- function(sp) {
species <- gsub(tolower(sp), pattern=' ', replacement='_')
speciesAb <- paste0(substr(sp,1,4), toupper(substr(sp,10,10)), substr(sp,11,13))
speciesAb_ <- sub("(.{4})(.*)", "\\1_\\2", speciesAb)
recordsRaw <- paste0('./cleaning_records/', species, '_finalRecords.rData')
load(recordsRaw)
fileName <- paste0('./megaSDM_TestRun/', sp, '.csv')
st_write(speciesSf_filtered_final,
fileName,
layer_options = "GEOMETRY=AS_XY",
append = F)
temp <- read.csv(fileName)
colnames(temp)[1:3] <- c('longitude', 'latitude', 'species')
write.csv(temp, fileName)
}
lapply(speciesList, toCSV)
occlist <- list.files('./megaSDM_TestRun', pattern = '.csv', full.names = T)
occ_output <- "./megaSDM_TestRun/occurrences"
#Reads the occurrence file
SpeciesOcc <- utils::read.csv(occlist[1])
SpeciesSplit <- unlist(strsplit(occlist[s], "/", fixed = TRUE))
SpeciesSplit <- unlist(strsplit(occlist[1], "/", fixed = TRUE))
SpeciesName <- substr(SpeciesSplit[length(SpeciesSplit)], 1,
nchar(SpeciesSplit[length(SpeciesSplit)]) - 4)
SpecCol <- grep(paste0("^", SpeciesName, "$|", "^", gsub("_", " ", SpeciesName), "$"),
SpeciesOcc[1,])
if (length(SpecCol) == 1) {
names(SpeciesOcc)[SpecCol] <- "Species"
} else {
SpeciesOcc$Species <- rep(SpeciesName, nrow(SpeciesOcc))
}
names(SpeciesOcc)[c(grep("lon", tolower(names(SpeciesOcc))),
grep("^x$", tolower(names(SpeciesOcc))))] <- "Longitude"
names(SpeciesOcc)[c(grep("lat", tolower(names(SpeciesOcc))),
grep("^y$", tolower(names(SpeciesOcc))))] <- "Latitude"
#Reads the occurrence file
SpeciesOcc <- utils::read.csv(occlist[1])
toCSV <- function(sp) {
species <- gsub(tolower(sp), pattern=' ', replacement='_')
speciesAb <- paste0(substr(sp,1,4), toupper(substr(sp,10,10)), substr(sp,11,13))
speciesAb_ <- sub("(.{4})(.*)", "\\1_\\2", speciesAb)
recordsRaw <- paste0('./cleaning_records/', species, '_finalRecords.rData')
load(recordsRaw)
fileName <- paste0('./megaSDM_TestRun/', sp, '.csv')
st_write(speciesSf_filtered_final,
fileName,
layer_options = "GEOMETRY=AS_XY",
append = F)
temp <- read.csv(fileName)
colnames(temp)[1:3] <- c('longitude', 'latitude', 'species')
write.csv(temp, fileName, row.names = F)
}
lapply(speciesList, toCSV)
rm(toCSV)
toCSV <- function(sp) {
species <- gsub(tolower(sp), pattern=' ', replacement='_')
speciesAb <- paste0(substr(sp,1,4), toupper(substr(sp,10,10)), substr(sp,11,13))
speciesAb_ <- sub("(.{4})(.*)", "\\1_\\2", speciesAb)
recordsRaw <- paste0('./cleaning_records/', species, '_finalRecords.rData')
load(recordsRaw)
fileName <- paste0('./megaSDM_TestRun/', sp, '.csv')
st_write(speciesSf_filtered_final,
fileName,
layer_options = "GEOMETRY=AS_XY",
append = F)
temp <- read.csv(fileName)
colnames(temp)[1:3] <- c('longitude', 'latitude', 'species')
write.csv(temp, fileName, row.names = FALSE)
}
lapply(speciesList, toCSV)
toCSV <- function(sp) {
species <- gsub(tolower(sp), pattern=' ', replacement='_')
speciesAb <- paste0(substr(sp,1,4), toupper(substr(sp,10,10)), substr(sp,11,13))
speciesAb_ <- sub("(.{4})(.*)", "\\1_\\2", speciesAb)
recordsRaw <- paste0('./cleaning_records/', species, '_finalRecords.rData')
load(recordsRaw)
fileName <- paste0('./megaSDM_TestRun/', sp, '.csv')
st_write(speciesSf_filtered_final,
fileName,
layer_options = "GEOMETRY=AS_XY",
append = F)
temp <- read.csv(fileName)
colnames(temp)[1:3] <- c('longitude', 'latitude', 'species')
write.csv(temp, fileName, row.names = FALSE)
}
lapply(speciesList, toCSV)
#Reads the occurrence file
SpeciesOcc <- utils::read.csv(occlist[1])
occlist <- list.files('./megaSDM_TestRun', pattern = '.csv', full.names = T)
#Reads the occurrence file
SpeciesOcc <- utils::read.csv(occlist[1])
#Determines the species name from the name of the occurrence file
SpeciesSplit <- unlist(strsplit(occlist[1], "/", fixed = TRUE))
SpeciesName <- substr(SpeciesSplit[length(SpeciesSplit)], 1,
nchar(SpeciesSplit[length(SpeciesSplit)]) - 4)
#Matches the species name to the correct column and renames it "Species"
SpecCol <- grep(paste0("^", SpeciesName, "$|", "^", gsub("_", " ", SpeciesName), "$"),
SpeciesOcc[1,])
#Adds a new column with species names if it doesn't already exist
if (length(SpecCol) == 1) {
names(SpeciesOcc)[SpecCol] <- "Species"
} else {
SpeciesOcc$Species <- rep(SpeciesName, nrow(SpeciesOcc))
}
#Matches the lat/long columns and renames them to standardize
names(SpeciesOcc)[c(grep("lon", tolower(names(SpeciesOcc))),
grep("^x$", tolower(names(SpeciesOcc))))] <- "Longitude"
names(SpeciesOcc)[c(grep("lat", tolower(names(SpeciesOcc))),
grep("^y$", tolower(names(SpeciesOcc))))] <- "Latitude"
#Takes only the species name and the coordinates for reprojection
SpeciesCoords <- SpeciesOcc[, c("Species", "Longitude", "Latitude")]
View(SpeciesCoords)
if ((max(SpeciesCoords$Longitude) > 180) | (max(SpeciesCoords$Latitude) > 90) |
(min(SpeciesCoords$Longitude) < -180) | (min(SpeciesCoords$Latitude) < -90)) {
stop("The species occurrence points are not given in latitude/longitude form. Reproject species occurrences to a latlon projection")
} else {
print("All good!")
}
occ_output <- "./megaSDM_TestRun/occurrences"
OccurrenceManagement(occlist = occlist,
output = occ_output,
envextract = TRUE,
envsample = TRUE,
nbins = 25,
envdata = TSEnv$training)
buff_output <- "megaSDM_TestRun/buffers"
BackgroundBuffers(occlist = occlist,
envdata = TSEnv$training,
buff_output,
ncores = 1)
occlist <- list.files(occ_output, pattern = ".csv", full.names = TRUE)
buff_output <- "megaSDM_TestRun/buffers"
BackgroundBuffers(occlist = occlist,
envdata = TSEnv$training,
buff_output,
ncores = 1)
# 10,000 background points
nbg <- 10000
# proportion of the background points sampled from within buffers
spatial_weights <- 0.5
# random or environmentally subsampled (Varela)?
sampleMethods <- "Varela"
bufflist <- list.files(buff_output, pattern = ".shp$", full.names = TRUE)
bg_output <- "megaSDM_TestRun/backgrounds"
BackgroundPoints(spplist = spplist,
envdata = TSEnv$training,
output = bg_output,
nbg = nbg,
spatial_weights = spatial_weights,
buffers = bufflist,
method = sampleMethod,
ncores = 2)
BackgroundPoints(spplist = speciesList,
envdata = TSEnv$training,
output = bg_output,
nbg = nbg,
spatial_weights = spatial_weights,
buffers = bufflist,
method = sampleMethod,
ncores = 1)
# random or environmentally subsampled (Varela)?
sampleMethod <- "Varela"
BackgroundPoints(spplist = speciesList,
envdata = TSEnv$training,
output = bg_output,
nbg = nbg,
spatial_weights = spatial_weights,
buffers = bufflist,
method = sampleMethod,
ncores = 1)
rm(list = ls())
library(dplyr)
library(ggplot2)
library(tidyr)
library(raster)
library(rgdal)
library(enmSdm)
library(terra)
library(maxnet)
library(sf)
library(maps)
library(rnaturalearth)
library(rnaturalearthdata)
library(rnaturalearthhires)
setwd('/Volumes/LJ MacBook Backup/MOBOT/PVMvsENM')
# load PCA data
load('./PCA_Beyer')
rm(list = ls())
library(dismo)
library(sp)
library(enmSdm)
library(xlsx)
library(geosphere)
library(raster)
library(data.table)
library(dplyr)
library(viridis)
library(maps)
setwd('/Volumes/lj_mac_22/MOBOT/PVMvsENM')
ll <- c('longitude', 'latitude')
gcmList_ <- c('Beyer','Lorenz_ccsm', 'ecbilt')
pc <- 5
predictors <- c(paste0('pca', 1:pc))
speciesList <- c('Fraxinus americana','Fraxinus caroliniana', 'Fraxinus cuspidata',
'Fraxinus greggii', 'Fraxinus nigra', 'Fraxinus pennsylvanica',
'Fraxinus profunda', 'Fraxinus quadrangulata')
# pollen <- readRDS('/Volumes/lj_mac_22/pollen/bv/FRAXINUS_bvs_n200_v4.1.RDS')
pollen <- readRDS('/Volumes/lj_mac_22/pollen/polya-gamma-predictions_4.1_overdispersed-001.RDS')
pollen_locs <- readRDS('/Volumes/lj_mac_22/pollen/pollen_locs_4.1.RDS')
pollen_dat <- readRDS('/Volumes/lj_mac_22/pollen/pollen_dat_4.1.RDS')
pollen_taxa <- readRDS('/Volumes/lj_mac_22/pollen/taxa_4.1.RDS')
pollen_grid <- readRDS('/Volumes/lj_mac_22/pollen/grid_4.1.RDS')
# keep only fraxinus
pollen_dat <- pollen_dat[1:465, 8, 1:22]
pollen_dat <- as.data.frame(pollen_dat)
colnames(pollen_dat) <- c(1:22)
pollen <- pollen$pi[1:200, 1:3951, 8, 1:22]
pollen <- as.data.frame(matrix(pollen, prod(dim(pollen)[1:2]), dim(pollen)[3]))
pollen <- cbind(pollen_grid, pollen)
